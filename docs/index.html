<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Cartes ChartFox via GitHub</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 600px; margin: 1rem auto; }
    input { width: 100%; padding: 0.5rem; font-size: 1rem; }
    a { display: block; margin: 0.3rem 0; }
  </style>
</head>
<body>
  <h1>Recherche de cartes ChartFox</h1>
  <input id="icao" maxlength="4" placeholder="Entrez code OACI (ex: LFPG)" />
  <div id="results"></div>

  <script>
    const resultsDiv = document.getElementById('results');
    const input = document.getElementById('icao');

    input.addEventListener('change', async () => {
      const icao = input.value.toUpperCase().trim();
      if (!/^[A-Z]{4}$/.test(icao)) {
        resultsDiv.innerHTML = 'Code OACI invalide';
        return;
      }
      resultsDiv.innerHTML = 'Chargement des cartes...';

      try {
        const res = await fetch(`./data/charts-${icao}.json`);
        if (!res.ok) throw new Error('Pas de données pour ce code');
        const data = await res.json();
        const charts = data.charts || [];

        const grouped = { SID: [], STAR: [], Approach: [], Other: [] };
        charts.forEach(c => {
          if (c.category.includes("SID")) grouped.SID.push(c);
          else if (c.category.includes("STAR")) grouped.STAR.push(c);
          else if (c.category.includes("Approach")) grouped.Approach.push(c);
          else grouped.Other.push(c);
        });

        resultsDiv.innerHTML = '';
        for (const group in grouped) {
          if (grouped[group].length > 0) {
            resultsDiv.innerHTML += `<h3>${group}</h3>`;
            grouped[group].forEach(c => {
              resultsDiv.innerHTML += `<a href="${c.url}" target="_blank">${c.name}</a>`;
            });
          }
        }
      } catch {
        resultsDiv.innerHTML = 'Pas de données pour ce code OACI. Lance le workflow GitHub Actions pour générer le fichier.';
      }
    });
  </script>
</body>
</html>
